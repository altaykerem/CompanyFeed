<!DOCTYPE html>
<html>
  	<head>
  		<meta charset="utf-8">
  		<meta http-equiv="X-UA-Compatible" content="IE=edge">
  		<meta name="viewport" content="width=device-width, initial-scale=1">
  		<title>Company Digest</title>
		<!-- Firebase -->
		<script src="https://www.gstatic.com/firebasejs/5.2.0/firebase.js"></script>
		<script src="https://www.gstatic.com/firebasejs/5.2.0/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/5.2.0/firebase-firestore.js"></script>
  
  		<!-- Bootstrap CSS -->
  		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  		<!-- Google Fonts -->
  		<link href='https://fonts.googleapis.com/css?family=Poppins:400,300,500,600,700' rel='stylesheet' type='text/css'>

		<!-- Style -->
		<link href='style.css' rel='stylesheet' type='text/css'>

		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
  	</head>
  	<body>
  		<nav class="navbar navbar-default" role="navigation">
  			<div class="container">
  				<!-- Brand and toggle get grouped for better mobile display -->
  				<div class="navbar-header">
  					<a class="navbar-brand" href="http://www.maxitech.com/">MAXITECH</a>
  				</div>
  			</div>
  		</nav>
		
		<!-- START SECTION -->
  		<div class="section text-center  background-dark dark-bg">
  			<div class="background-image" style="background: url(bosphorus.jpg) no-repeat center center; background-size: cover; opacity: .2;"></div>
  			<div class="container">
  				<div class="row">
  					<div class="col-md-12">
  						<h2 class="section-title">Query Control</h2>
						<p class="section-description">Design your search parameters for the best fit</p>
						<h2>Notes</h2>
						<p>Date can be in the form of fri or mon. For all weekdays type mon-fri</p>
						<p>Already developed companies have high growth score, an upper bound might shift the focus to developing companies</p>
						<p>Momentum is the weekly change in growth</p>
						<p>Page(doesn't work for now) size determines the number of results returned</p>
						<p>Sort related modifications doesn't work for now</p>
  					</div>
  				</div>
  			</div>
  		</div>
  		<!--/.section -->

  		<!-- START SECTION -->
  		<div class="section">
  			<div class="container">
  				<div class="row">
  					<div class="col-md-12 text-center">
  						<h2 class="section-title">Parameters</h2>
  					</div>
  					<div class="col-md-8 col-md-offset-2">
  						<form id="params" name="params" method="post" class="form" role="form">
  							<div class="row">
								<div class="col-md-4">
									<p class="text-center">Date</p>
								</div>
								<div class="col-md-4 form-group">
									<input class="form-control" id="time" name="time" placeholder="time" type="text" />
								</div>
								<div class="col-md-4 form-group">
									<input class="form-control" id="day" name="day" placeholder="day" type="text" />
								</div>
							</div>

							<div class="row">
								<div class="col-md-4">
									<p class="text-center">Momentum</p>
								</div>
								<div class="col-md-8 form-group">
									<input class="form-control" id="momentumMin" name="momentumMin" placeholder="min" type="text" />
								</div>
							</div>

							<div class="row">
								<div class="col-md-4">
									<p class="text-center">Growth Score</p>
								</div>
								<div class="col-md-4 form-group">
									<input class="form-control" id="growthMin" name="growthMin" placeholder="min" type="text" />
								</div>
								<div class="col-md-4 form-group">
									<input class="form-control" id="growthMax" name="growthMax" placeholder="max" type="text" />
								</div>
							</div>

							<div class="row">
								<div class="col-md-4">
									<p class="text-center">Page Size</p>
								</div>
								<div class="col-md-8 form-group">
									<input class="form-control" id="query-size" name="query-size" value="10" type="text" />
								</div>
							</div>

							<div class="row">
								<div class="col-md-4">
									<p class="text-center">Sort</p>
								</div>
								<div class="col-md-4 form-group">
									<select class="form-control" id="criteria" name="criteria">
										<option selected="selected" value="funding-date">Funding Date</option>
										<option value="score">Score</option>
										<option value="funding-amount">Funding Amount</option>
									</select>
								</div>
								<div class="col-md-4 form-group">
									<select class="form-control" id="direction" name="direction">
										<option selected="selected" value="desc">Decending</option>
										<option value="asc">Ascending</option>
									</select>
								</div>
							</div>

							<div class="row">
								<div class="col-md-2 text-center form-group">
									<button type="button" class="btn btn-primary" onclick="adjustFilters()">Submit</button>
								</div>
							</div>
  						</form>
  					</div>
  				</div><!--/.row-->
  			</div><!--/.container-->
  		</div>
  		<!--/.section -->
		<!-- START SECTION -->
  		<div class="section text-center  background-dark dark-bg">
  			<div class="container">
  				<div class="row">
  					<div class="col-md-8 col-md-offset-2">
  						<h2 class="section-title">Mailing List Options</h2>
						<div class="col-md-8 col-md-offset-2 text-center">
							<h3>Add Mail</h3>
							<input class="form-control" id="add_mail" name="add_mail" placeholder="enter email" type="text" />
							<button type="button" class="btn btn-primary btn-block" onclick="addMail()">Add</button>
						</div>
						<div class="col-md-8 col-md-offset-2 text-center">
							<h3>Remove Mail</h3>
							<input class="form-control" id="remove_mail" name="remove_mail" placeholder="enter email" type="text" />
							<button type="button" class="btn btn-primary btn-block" onclick="removeMail()">Remove</button>
						</div>
  					</div>
  				</div>
  			</div>
  		</div>
  		<!--/.section -->

		<!-- js -->
		<script type="text/javascript">
			initializeDB();
			var db = firebase.firestore();

			var docRef = db.collection("runtime").doc("parameters");

			docRef.get().then(function(doc) {
			    if (doc.exists) {
					document.getElementById('time').value = doc.data().time;
					document.getElementById('day').value = doc.data().day;
					document.getElementById('momentumMin').value = doc.data().momentumMin;
					document.getElementById('growthMin').value = doc.data().growthMin;
					document.getElementById('growthMax').value = doc.data().growthMax;
					document.getElementById('query-size').value = doc.data().pageSize;
			    } else {
			        // doc.data() will be undefined in this case
			        console.log("No such document!");
			    }
			}).catch(function(error) {
			    console.log("Error getting document:", error);
			});

			function initializeDB(){
				if (!firebase.apps.length) {
					var config = {
						apiKey: window.firebase_web_api,
						authDomain: "company-feed.firebaseapp.com",
						databaseURL: "https://company-feed.firebaseio.com",
						projectId: "company-feed",
						storageBucket: "company-feed.appspot.com",
						messagingSenderId: "115430820745"
					};
					firebase.initializeApp(config);
		    	}
			}

			function adjustFilters(){
			    initializeDB();

			    var db = firebase.firestore();

			    var updateObject = {};

			    if (validateField("time")) {
			        updateObject.time = document.forms["params"]["time"].value;
			    }
			    if (validateField("day")) {
			        updateObject.day = document.forms["params"]["day"].value;
			    }
			    if (validateField("momentumMin")) {
			        updateObject.momentumMin = Number(document.forms["params"]["momentumMin"].value);
			    }
			    if (validateField("growthMin")) {
			        updateObject.growthMin = Number(document.forms["params"]["growthMin"].value);
			    }
			    if (validateField("growthMax")) {
			        updateObject.growthMax = Number(document.forms["params"]["growthMax"].value);
			    }
			    if (validateField("criteria")) {
			        updateObject.criteria = document.forms["params"]["criteria"].value;
			    }
			    if (validateField("direction")) {
			        updateObject.sort = document.forms["params"]["direction"].value;
			    }
			    if (validateField("query-size")) {
			        updateObject.pageSize = document.forms["params"]["query-size"].value;
			    }            

			    db.collection("runtime").doc("parameters").set(updateObject, { merge: true })
			    .then(function(docRef) {
			        console.log("Document written with ID: ", docRef.id);
			    })
			    .catch(function(error) {
			        console.error("Error adding document: ", error);
			    });

			    window.alert("Parameters changed");
			}

			function addMail(){
				initializeDB();
				var db = firebase.firestore();

				var mail = document.getElementById("add_mail").value;

				db.collection("users").doc(mail).set({
				    mail: mail
				})
				.then(function(docRef) {
				    console.log("Document written with ID: ", docRef.id);
				})
				.catch(function(error) {
				    console.error("Error adding document: ", error);
				});

				window.alert("Mail added");
			}

			function removeMail(){
				initializeDB();
				var db = firebase.firestore();

				var mail = document.getElementById("remove_mail").value;

				db.collection("users").doc(mail).delete().then(function() {
				    console.log("Document successfully deleted!");
				}).catch(function(error) {
				    console.error("Error removing document: ", error);
				});

				window.alert("Mail removed");
			}

			function validateField(param){
			    if (document.forms["params"][param].value != "") {
			      return true;
			    }
			    return false;
			}
		</script>
  		<!-- jQuery -->
  		<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  		<!-- Bootstrap JavaScript -->
  		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  	</body>
  </html>